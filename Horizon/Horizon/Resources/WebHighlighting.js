(()=>{"use strict";var e={14:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=window.getSelection(),t=null==e?void 0:e.getRangeAt(0),n=document.getElementById("parent-container"),s=n&&t?o.RangeAnchor.fromRange(n,t):null,i=n&&t?r.TextPositionAnchor.fromRange(n,t):null;return{selectedText:null==e?void 0:e.toString(),textPosition:null==i?void 0:i.toSelector(),range:null==s?void 0:s.toSelector()}};const o=n(671),r=n(442)},16:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.nodeFromXPath=t.xpathFromNode=void 0;const n=e=>{const t=(e=>{const t=e.nodeName.toLowerCase();return"#text"===t?"text()":t})(e),n=function(e){let t=0,n=e;for(;n;)n.nodeName===e.nodeName&&(t+=1),n=n.previousSibling;return t}(e);return`${t}[${n}]`};t.xpathFromNode=(e,t)=>{let o="",r=e;for(;r!==t;){if(!r)return void console.error("Node is not a descendant of root");o=`${n(r)}/${o}`,r=r.parentNode}return o=`/${o}`,o=o.replace(/\/$/,""),o};const o=(e,t,n)=>{const o=t.toUpperCase();let r=-1;for(let t=0;t<e.children.length;t++){const s=e.children[t];if(s.nodeName.toUpperCase()===o&&(++r,r===n))return s}return null};t.nodeFromXPath=(e,t=document.body)=>{try{return((e,t)=>{if(null===e.match(/^(\/[A-Za-z0-9-]+(\[[0-9]+])?)+$/))return console.error("Expression is not a simple XPath"),null;const n=e.split("/");let r=t;n.shift();for(const e of n){let t,n;const s=e.indexOf("[");if(-1!==s){t=e.slice(0,s);const o=e.slice(s+1,e.indexOf("]"));if(n=Number.parseInt(o)-1,n<0)return null}else t=e,n=0;const i=o(r,t,n);if(!i)return null;r=i}return r})(e,t)}catch(n){return document.evaluate(`.${e}`,t,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}}},86:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildHighlightStyle=t.addHighlight=void 0,t.default=function(e){(function(){const e=document.getElementsByClassName(r);for(;e.length;){const t=e[0];t.replaceWith(...t.childNodes)}})(),e.forEach(t.addHighlight)};const o=n(671),r="notebook-highlight";t.addHighlight=e=>{var t;let n=document.getElementById("parent-container");if(!n)return;let r=null===(t=o.RangeAnchor.fromSelector(n,e.range))||void 0===t?void 0:t.toRange();if(!r)return;const i=s(r);for(const t of i){const n=t.parentNode,o=a({textContent:t.textContent,notebookTextSelection:e});if(!o)return;n.replaceChild(o,t)}};const s=e=>{const t=i(e),n=/^\s*$/;return t.filter((e=>{const t=e.parentElement;return 1===(null==t?void 0:t.childNodes.length)&&"SPAN"===(null==t?void 0:t.tagName)||!n.test(e.data)}))},i=e=>{var t;if(e.collapsed)return[];let n=e.commonAncestorContainer;if(n&&n.nodeType!==Node.ELEMENT_NODE&&(n=n.parentElement),!n)return[];const o=[],r=null===(t=null==n?void 0:n.ownerDocument)||void 0===t?void 0:t.createNodeIterator(n,NodeFilter.SHOW_TEXT);let s=(null==r?void 0:r.nextNode())||null;for(;s;){if(!l(e,s)){s=(null==r?void 0:r.nextNode())||null;continue}const t=s;t===e.startContainer&&e.startOffset>0?(t.splitText(e.startOffset),s=(null==r?void 0:r.nextNode())||null):(t===e.endContainer&&e.endOffset<t.data.length&&t.splitText(e.endOffset),o.push(t),s=(null==r?void 0:r.nextNode())||null)}return o},l=(e,t)=>{var n,o;try{const r=null!==(o=null===(n=t.nodeValue)||void 0===n?void 0:n.length)&&void 0!==o?o:t.childNodes.length;return e.comparePoint(t,0)<=0&&e.comparePoint(t,r)>=0}catch(e){return!1}},a=({textContent:e,notebookTextSelection:n})=>{if(!e)return null;const o=document.createElement("span");return o.classList.add(r),o.onclick=()=>(e=>{window.webkit.messageHandlers.notebookHighlightTap.postMessage(JSON.stringify(e))})(n),o.style.cssText=(0,t.buildHighlightStyle)(n),o.textContent=e,o};t.buildHighlightStyle=e=>`position: relative;\n   padding: 0px;\n   border-top: none;\n   border-right: none;\n   border-bottom: 1px solid ${e.borderColor};\n   background-color: ${e.backgroundColor};`},201:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(86)),s=o(n(14));window.applyHighlights=r.default,window.getSelectionCoordinates=s.default},442:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextPositionAnchor=void 0;const o=n(823);class r{constructor(e,t,n){this.root=e,this.start=t,this.end=n}static fromRange(e,t){var n;const s=null===(n=o.TextRange.fromRange(t))||void 0===n?void 0:n.relativeTo(e);return s?new r(e,s.start.offset,s.end.offset):null}static fromSelector(e,t){return new r(e,t.start,t.end)}toSelector(){return{start:this.start,end:this.end}}toRange(){return o.TextRange.fromOffsets(this.root,this.start,this.end).toRange()}}t.TextPositionAnchor=r},482:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resolveOffsets=t.previousSiblingsTextLength=t.nodeTextLength=void 0,t.nodeTextLength=e=>{var t,n;switch(e.nodeType){case Node.ELEMENT_NODE:case Node.TEXT_NODE:return null!==(n=null===(t=e.textContent)||void 0===t?void 0:t.length)&&void 0!==n?n:0;default:return 0}},t.previousSiblingsTextLength=e=>{let n=e.previousSibling,o=0;for(;n;)o+=(0,t.nodeTextLength)(n),n=n.previousSibling;return o},t.resolveOffsets=(e,...t)=>{let n=t.shift();const o=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT),r=[];let s=o.nextNode(),i=null,l=0;for(;void 0!==n&&s;)i=s,l+i.data.length>n?(r.push({node:i,offset:n-l}),n=t.shift()):(s=o.nextNode(),l+=i.data.length);for(;void 0!==n&&i&&l===n;)r.push({node:i,offset:i.data.length}),n=t.shift();return void 0!==n&&console.error("Offset exceeds text length"),r}},543:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextPosition=void 0;const o=n(482),r=n(823);class s{constructor(e,t){t<0&&console.error("Offset is invalid"),this.element=e,this.offset=t}resolve(e={}){try{return(0,o.resolveOffsets)(this.element,this.offset)[0]}catch(t){if(0===this.offset&&void 0!==e.direction){const n=document.createTreeWalker(this.element.getRootNode(),NodeFilter.SHOW_TEXT);n.currentNode=this.element;const o=e.direction===r.ResolveDirection.FORWARDS,s=o?n.nextNode():n.previousNode();if(!s)throw t;return{node:s,offset:o?0:s.data.length}}throw t}}static fromCharOffset(e,t){switch(e.nodeType){case Node.TEXT_NODE:return s.fromPoint(e,t);case Node.ELEMENT_NODE:return new s(e,t);default:return console.error("Node is not an element or text node"),null}}static fromPoint(e,t){switch(e.nodeType){case Node.TEXT_NODE:{if(t<0||t>e.data.length)return console.error("Text node offset is out of range"),null;if(!e.parentElement)return console.error("Text node has no parent"),null;const n=(0,o.previousSiblingsTextLength)(e)+t;return new s(e.parentElement,n)}case Node.ELEMENT_NODE:{if(t<0||t>e.childNodes.length)return console.error("Child node offset is out of range"),null;let n=0;for(let r=0;r<t;r++)n+=(0,o.nodeTextLength)(e.childNodes[r]);return new s(e,n)}default:return console.error("Point is not in an element or text node"),null}}relativeTo(e){if(!e.contains(this.element))throw new Error("Parent is not an ancestor of current element");let t=this.element,n=this.offset;for(;t!==e;)n+=(0,o.previousSiblingsTextLength)(t),t.parentElement&&(t=t.parentElement);return new s(t,n)}}t.TextPosition=s},671:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RangeAnchor=void 0;const o=n(543),r=n(823),s=n(16);class i{constructor(e,t){this.root=e,this.range=t}static fromRange(e,t){return new i(e,t)}static fromSelector(e,t){if(!(null==t?void 0:t.startContainer)||!(null==t?void 0:t.endContainer))return console.error("No start or end container in selector"),null;const n=(0,s.nodeFromXPath)(t.startContainer,e);if(!n)return console.error("Failed to resolve startContainer XPath"),null;const l=(0,s.nodeFromXPath)(t.endContainer,e);if(!l)return console.error("Failed to resolve endContainer XPath"),null;const a=o.TextPosition.fromCharOffset(n,t.startOffset),d=o.TextPosition.fromCharOffset(l,t.endOffset);if(!a||!d)return null;const c=new r.TextRange(a,d).toRange();return new i(e,c)}toRange(){return this.range}toSelector(){var e;const t=null===(e=r.TextRange.fromRange(this.range))||void 0===e?void 0:e.toRange(),n=t&&r.TextRange.fromRange(t),o=n&&(0,s.xpathFromNode)(n.start.element,this.root),i=n&&(0,s.xpathFromNode)(n.end.element,this.root);return o&&i?{startContainer:o,startOffset:n.start.offset,endContainer:i,endOffset:n.end.offset}:null}}t.RangeAnchor=i},823:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextRange=t.ResolveDirection=void 0;const o=n(543),r=n(482);var s;!function(e){e[e.FORWARDS=1]="FORWARDS",e[e.BACKWARDS=2]="BACKWARDS"}(s||(t.ResolveDirection=s={}));class i{constructor(e,t){this.start=e,this.end=t}toRange(){let e,t;this.start.element===this.end.element&&this.start.offset<=this.end.offset?[e,t]=(0,r.resolveOffsets)(this.start.element,this.start.offset,this.end.offset):(e=this.start.resolve({direction:s.FORWARDS}),t=this.end.resolve({direction:s.BACKWARDS}));const n=new Range;return n.setStart(e.node,e.offset),n.setEnd(t.node,t.offset),n}static fromRange(e){const t=o.TextPosition.fromPoint(e.startContainer,e.startOffset),n=o.TextPosition.fromPoint(e.endContainer,e.endOffset);return t&&n?new i(t,n):null}static fromOffsets(e,t,n){return new i(new o.TextPosition(e,t),new o.TextPosition(e,n))}relativeTo(e){return new i(this.start.relativeTo(e),this.end.relativeTo(e))}}t.TextRange=i}},t={};!function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}(201)})();