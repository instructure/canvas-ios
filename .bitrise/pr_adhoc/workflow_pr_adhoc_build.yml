---
format_version: '13'
workflows:
  pr_adhoc_build:
    summary: This workflow stamps the app icon and builds an ad-hoc build used for pull request testing.
    description: "This step expects the following environment variable: \n$INST_XCODE_SCHEME (e.g., Student)\n\nThe output will be an IPA file ready for deployment."
    steps:
    - set-xcode-build-number@2:
        inputs:
        - scheme: $INST_XCODE_SCHEME
    - bitrise-step-stamp-appicon-with-version-number@1:
        inputs:
        - stamp_version: PR
        - stamp_build_number: $PR_NUMBER
        - stamp_path_to_icons: ${INST_XCODE_SCHEME}/${INST_XCODE_SCHEME}/Assets.xcassets/AppIcon.appiconset
    - xcode-archive@5.8:
        inputs:
        - distribution_method: ad-hoc
        - automatic_code_signing: api-key
        - icloud_container_environment: Production
        - scheme: $INST_XCODE_SCHEME
