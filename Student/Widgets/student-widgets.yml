---
targets:
  Widgets:
    type: app-extension
    platform: iOS
    transitivelyLinkDependencies: true
    settings:
      APPLICATION_EXTENSION_API_ONLY: true
      ENABLE_TESTABILITY: true
      SWIFT_EMIT_LOC_STRINGS: true
      PRODUCT_BUNDLE_IDENTIFIER: com.instructure.icanvas.widgets
      INFOPLIST_FILE: Widgets/Resources/Info.plist
      CODE_SIGN_ENTITLEMENTS: Widgets/Resources/Widgets.entitlements
      TARGETED_DEVICE_FAMILY: 1,2
      DEBUG_INFORMATION_FORMAT: "dwarf-with-dsym"
      ENABLE_DEBUG_DYLIB: false
    sources:
      - path: ./
        excludes:
          - ".swiftlint.yml"
    dependencies:
      - target: Core/Core
      - package: FirebaseCrashlytics
      - package: FirebaseRemoteConfig
      - package: FirebaseRemoteConfigSwift
    postBuildScripts:
      - script: "\"${BUILD_DIR%/Build/*}/SourcePackages/checkouts/firebase-ios-sdk/Crashlytics/run\""
        name: Upload dSYMs to Firebase
        basedOnDependencyAnalysis: false
        inputFiles:
          - ${DWARF_DSYM_FOLDER_PATH}/${DWARF_DSYM_FILE_NAME}
          - ${DWARF_DSYM_FOLDER_PATH}/${DWARF_DSYM_FILE_NAME}/Contents/Resources/DWARF/${PRODUCT_NAME}
          - ${DWARF_DSYM_FOLDER_PATH}/${DWARF_DSYM_FILE_NAME}/Contents/Info.plist
          - ${DWARF_DSYM_FOLDER_PATH}/${DWARF_DSYM_FILE_NAME}/Contents/Resources/DWARF/${PRODUCT_NAME}.debug.dylib
          - $(TARGET_BUILD_DIR)/$(UNLOCALIZED_RESOURCES_FOLDER_PATH)/GoogleService-Info.plist
          - $(TARGET_BUILD_DIR)/$(EXECUTABLE_PATH)
schemes:
  Widgets - Announcements:
    build:
      targets:
        Widgets: all
    run:
      targets:
        Widgets: all
      environmentVariables:
        _XCWidgetKind: AnnouncementsWidget
  Widgets - Todo:
    build:
      targets:
        Widgets: all
        Student: all
    run:
      askForAppToLaunch: true
      environmentVariables:
        _XCWidgetKind: TodoWidget
        _XCWidgetFamily: systemMedium
    profile:
      askForAppToLaunch: true
  Widgets - GradeList:
    build:
      targets:
        Widgets: all
        Student: all
    run:
      askForAppToLaunch: true
      environmentVariables:
        _XCWidgetKind: GradeListWidget
        _XCWidgetFamily: systemMedium
    profile:
      askForAppToLaunch: true
  Widgets - CourseTotalGrade:
    build:
      targets:
        Widgets: all
        Student: all
    run:
      askForAppToLaunch: true
      environmentVariables:
        _XCWidgetKind: CourseTotalGradeWidget
        _XCWidgetFamily: systemSmall
    profile:
      askForAppToLaunch: true
