---
name: CITest
on:
  push:
    branches:
      - '*'
      - '!master'

jobs:
  citest:
    name: CITest
    runs-on: macOS-10.14
    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1
      - name: Brew Install
        run: brew install bitrise
      - name: Bitrise Secrets
        run: |
          printf "%s" "${{ secrets.BITRISE_SECRETS_YML }}" > .bitrise.secrets.yml
      - name: Canvas iOS Secrets
        run: |
          git clone https://ios-danger:${{ secrets.DANGER_GITHUB_TOKEN }}@github.com/instructure/steps-canvas-ios-secrets ../secrets
          ../secrets/scripts/setup-dev-secrets.sh
      - name: Bitrise
        run: |
          bitrise --ci run danger --config scripts/build_automation/bitrise_workflows/tests.yml
