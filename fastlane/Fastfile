# Ad-Hoc
provisioning_profiles_ad_hoc = {
  "com.instructure.icanvas": "match AdHoc com.instructure.icanvas",
  "com.instructure.icanvas.SubmitAssignment": "match AdHoc com.instructure.icanvas.SubmitAssignment",
  "com.instructure.icanvas.widgets": "match AdHoc com.instructure.icanvas.widgets"
}

default_platform(:ios)

platform :ios do
  before_all do    
    setup_circle_ci
  end

  desc "Ad-hoc Student Build"
  lane :adhoc_student do
    match(type: "adhoc")

    update_code_signing_settings(
      use_automatic_signing: false,
      targets: ["Student"],
      path: "Student/Student.xcodeproj",
      code_sign_identity: "Apple Distribution: Instructure, Inc. (B6333T4PXQ)",
      profile_name: "match AdHoc com.instructure.icanvas"  
    )

    update_code_signing_settings(
      use_automatic_signing: false,
      targets: ["SubmitAssignment"],
      path: "Student/Student.xcodeproj",
      code_sign_identity: "Apple Distribution: Instructure, Inc. (B6333T4PXQ)",
      profile_name: "match AdHoc com.instructure.icanvas.SubmitAssignment"  
    )

    update_code_signing_settings(
      use_automatic_signing: false,
      targets: ["Widgets"],
      path: "Student/Student.xcodeproj",
      code_sign_identity: "Apple Distribution: Instructure, Inc. (B6333T4PXQ)",
      profile_name: "match AdHoc com.instructure.icanvas.widgets"  
    )

    gym(
      scheme: "Student",
      export_method: "ad-hoc",
      export_options: { 
        signingCertificate: "Apple Distribution: Instructure, Inc. (B6333T4PXQ)",
        provisioningProfiles: provisioning_profiles_ad_hoc
      }
    )

    firebase_app_distribution(
      service_credentials_file: "#{ENV['HOME']}/gservice-key.json"
    )

  end
end